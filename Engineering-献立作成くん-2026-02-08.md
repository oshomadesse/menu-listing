---
tags:
  - engineering
  - menu-listing
  - done
---
# 献立作成くん - 仕様書

献立作成→食材抽出→買い物リスト出力までを自動化するClaude Codeエージェントシステム。

## 概要

- **形式**: Claude Codeエージェント + スキル
- **エージェント**: `meal-manager`（全フロー自己完結）
- **スキル**: `ingredient-manager`（食材分類・換算・マージルール）
- **出力先**: `11_Engineering/🍳 menu-listing/data/食材リスト_{N}人分.md`

---

## アーキテクチャ

```
ユーザー: 「来週の献立作って」
    ↓
[meal-manager agent]
  Phase 1: 前回献立の確認（直近3ファイル → 除外リスト）
  Phase 2: ヒアリング（日数・人数・在庫・主菜・NG食材）
  Phase 3: 献立作成（ジャンル統一 + 栄養/ダイエットバランス + レシピURL検索）→ ユーザー確認
  Phase 4: 食材抽出（WebFetchで各URL取得。失敗時→スクショ要求→Read）
  Phase 5: 統合出力（ingredient-managerスキル参照 → md出力）
```

エージェント1つで全フロー完結。親への委譲なし。

---

## ファイル構成

| ファイル | 役割 |
|---------|------|
| `.claude/agents/meal-manager.md` | メインエージェント定義 |
| `.claude/skills/ingredient-manager/SKILL.md` | 食材分類・換算・マージルール |
| `11_Engineering/🍳 menu-listing/data/` | 食材リスト出力先 |

---

## Phase 1: 前回献立の確認

1. `data/` 内の献立表ファイル（`*-献立表-*.md`）を日付降順で直近3ファイル読み込み
2. 主菜・副菜を**提案除外リスト**として保持（Phase 3で重複排除に使用）

---

## Phase 2: ヒアリング

以下の情報を収集する。不足情報だけ聞く。最小限のやりとり。

| 項目 | デフォルト | 備考 |
|------|-----------|------|
| 日数 | なし（必須） | 何日分の献立か。必ず最初に確認 |
| 人数 | 2人 | 食材の分量換算に使用 |
| 対象の食事 | 晩ごはん | |
| 在庫食材 | なし | 優先消費対象 |
| 主菜の希望 | なし | 自由提案 |
| NG食材 | セロリ、いくら、パクチー | |

---

## Phase 3: 献立作成

### 構成ルール

- 献立は **主食 + 主菜 + 副菜** の3列構成（汁物は副菜に含む）
- 主菜のジャンルに合わせて副菜を選定（和→和、洋→洋、中→中、韓→韓）
- 日ごとに異なるジャンルを意識し、偏りを防ぐ
- Phase 1の除外リストに含まれるメニューは提案しない

### 栄養バランスルール

- **たんぱく質ローテーション**: 連日同じ主たんぱく源（鶏→鶏等）を避ける。肉（豚・牛・鶏）・魚・大豆製品を日ごとに回す
- **調理法の分散**: 揚げ物が連日にならないようにする。焼き・煮・蒸し・炒め・揚げ・生をバラけさせる

### ダイエットバランスルール

- **重さの定性判断**: 各日の献立を「重い/普通/軽い」の3段階で判定し、重い日が連続しないようにする
  - 重い: 揚げ物、クリーム系、チーズ系、丼物
  - 普通: 炒め物、焼き物、煮物
  - 軽い: 蒸し物、サラダ系、スープ系

### 主食の自動判定

- 主菜に米・パン・麺が含まれる場合（チャーハン、パスタ、焼きそば等）→ 主食は「-」
- それ以外 → 白ごはん、パン等を適宜設定

### レシピURL

- WebSearchで検索し、定番レシピサイトを優先
  - クラシル、白ごはん.com、デリッシュキッチン、Nadia、cookpad等
- 在庫食材を優先消費するレシピを選定

### 献立表フォーマット

```
| 日 | 重さ | 主食 | 主菜 | 副菜 |
|----|------|------|------|------|
| 1日目 | 普通 | 白ごはん | 肉じゃが（URL） | ほうれん草のおひたし（URL） |
| 2日目 | 軽い | - | 焼きそば（URL） | 中華スープ（URL） |
```

- レシピ名とURLを両方表示する（Markdownリンク `[名前](URL)` は使わない）

ユーザー確認後、次フェーズへ進む。

---

## Phase 4: 食材抽出

1. 確定した全レシピURLにWebFetchで食材・分量を取得
2. 各レシピの元人数を確認し、指定人数に換算
3. WebFetch失敗時 → ユーザーにスクリーンショットを要求 → Readで画像読み込み → 食材抽出

---

## Phase 5: 統合出力（ingredient-managerスキル）

### 種別分類（7種別）

| 種別 | 含まれる食材 |
|------|------------|
| 野菜 | 葉物、根菜、果菜、きのこ、薬味（にんにく・生姜）、冷凍野菜、果物（レモン等） |
| 精肉 | 豚・牛・鶏・ひき肉、加工肉（ベーコン・ハム・ソーセージ） |
| 鮮魚 | 魚、えび、いか、貝類、練り物（ちくわ等） |
| 乳卵 | 卵、うずら卵、牛乳、チーズ、バター、生クリーム |
| 乾物 | 乾麺、春雨、わかめ、のり、鰹節、麺類 |
| 調味料 | 醤油、みりん、酒、砂糖、塩、油類、スパイス、ソース類、だし類、ごま |
| その他 | キムチ、納豆、豆腐、粉類（小麦粉・パン粉）、揚げ油 |

### 人数換算ルール

- 比例計算。卵など割り切れないものは切り上げ
- 「適量」「少々」はそのまま維持
- 人数表記なしのレシピは主食材の量から推定

### マージルール

- 同一食材名は分量合算
- 単位変換目安: 大さじ1=小さじ3=15ml、ねぎ1本≒100g
- 「適量」同士は「適量」のまま。数値+適量は併記
- 濃口醤油と薄口醤油は別食材

### 出力フォーマット

`11_Engineering/🍳 menu-listing/data/食材リスト_{N}人分.md`（タブ区切り）

```
種別	食材名	分量	メモ
野菜	にんじん	3本
野菜	玉ねぎ	2個
精肉	豚バラ薄切り	400g
調味料	醤油	大さじ5
```

- 種別順序: 野菜 → 精肉 → 鮮魚 → 乳卵 → 乾物 → 調味料 → その他
- 在庫にある食材はメモ欄に「在庫あり」記載
